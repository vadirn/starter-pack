import { scaffoldCollection } from './scaffold-collection';
import { scaffoldIndex } from './scaffold-index';

export function scaffoldChildCollection(createResource) {
  const collection = scaffoldCollection(createResource);
  const parentIndex = scaffoldIndex(collection.entries);

  /**
   * Add new resource to collection
   * @param parent Parent resource
   * @param data {object} Resource props
   * @return {*} Resource
   */
  const add = (parent, data) => {
    const entry = collection.add(data);
    parentIndex.add(parent.cid ?? parent, entry.cid);
    return entry;
  };

  /**
   * Add multiple resources to collection
   * @param parent Parent resource
   * @param dataArray {Object[]}
   */
  const addMany = (parent, dataArray) => {
    const entries = collection.addMany(dataArray);
    for (const entry of entries) {
      parentIndex.add(parent.cid ?? parent, entry.cid, false);
    }
    parentIndex.incrementTag();
    return entries;
  };

  return {
    ...collection,
    parentIndex,
    add,
    addMany,
  };
}
